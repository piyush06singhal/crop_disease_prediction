<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - Crop Disease Prediction System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background: linear-gradient(135deg, #28a745, #20c997);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .metric-card.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        .metric-card.warning {
            background: linear-gradient(135deg, #fcb045 0%, #fd1d1d 100%);
        }
        .metric-card.info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
        .stat-icon {
            font-size: 2rem;
            opacity: 0.8;
        }
        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .alert-custom {
            border-radius: 10px;
            border: none;
        }
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        .badge-custom {
            font-size: 0.8rem;
        }
        .progress-custom {
            height: 8px;
            border-radius: 4px;
        }
        .nav-tabs .nav-link {
            border: none;
            border-radius: 10px 10px 0 0;
            color: #6c757d;
            font-weight: 500;
        }
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        .tab-content {
            background: white;
            border-radius: 0 0 15px 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-chart-line me-2"></i>
                Analytics Dashboard
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/predict">
                            <i class="fas fa-leaf me-1"></i>Predict
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/analytics">
                            <i class="fas fa-chart-bar me-1"></i>Analytics
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-1">
                            <i class="fas fa-tachometer-alt text-success me-2"></i>
                            System Analytics
                        </h2>
                        <p class="text-muted mb-0">Real-time monitoring and insights for crop disease prediction</p>
                    </div>
                    <div class="d-flex align-items-center">
                        <span class="badge bg-success me-2" id="status-badge">
                            <i class="fas fa-circle me-1"></i>Live
                        </span>
                        <small class="text-muted" id="last-updated">Last updated: <span id="update-time">Just now</span></small>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Metrics Cards -->
        <div class="row mb-4" id="system-metrics">
            <div class="col-xl-3 col-lg-6 col-md-6 mb-4">
                <div class="card metric-card success h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">CPU Usage</h6>
                                <h3 class="mb-0" id="cpu-percent">--</h3>
                                <small class="text-muted">Current load</small>
                            </div>
                            <i class="fas fa-microchip stat-icon"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 mb-4">
                <div class="card metric-card info h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">Memory Usage</h6>
                                <h3 class="mb-0" id="memory-percent">--</h3>
                                <small class="text-muted">RAM utilization</small>
                            </div>
                            <i class="fas fa-memory stat-icon"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 mb-4">
                <div class="card metric-card warning h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">Disk Usage</h6>
                                <h3 class="mb-0" id="disk-percent">--</h3>
                                <small class="text-muted">Storage used</small>
                            </div>
                            <i class="fas fa-hdd stat-icon"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 mb-4">
                <div class="card metric-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">Active Requests</h6>
                                <h3 class="mb-0" id="active-requests">--</h3>
                                <small class="text-muted">Concurrent users</small>
                            </div>
                            <i class="fas fa-users stat-icon"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Analytics Tabs -->
        <div class="row">
            <div class="col-12">
                <ul class="nav nav-tabs mb-3" id="analyticsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="system-tab" data-bs-toggle="tab" data-bs-target="#system" type="button" role="tab">
                            <i class="fas fa-server me-1"></i>System Performance
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="predictions-tab" data-bs-toggle="tab" data-bs-target="#predictions" type="button" role="tab">
                            <i class="fas fa-leaf me-1"></i>Predictions
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">
                            <i class="fas fa-users me-1"></i>User Behavior
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="models-tab" data-bs-toggle="tab" data-bs-target="#models" type="button" role="tab">
                            <i class="fas fa-brain me-1"></i>Model Performance
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="errors-tab" data-bs-toggle="tab" data-bs-target="#errors" type="button" role="tab">
                            <i class="fas fa-exclamation-triangle me-1"></i>Errors
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="analyticsTabsContent">
                    <!-- System Performance Tab -->
                    <div class="tab-pane fade show active" id="system" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-8 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-chart-line me-2"></i>System Metrics Over Time
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="systemChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-network-wired me-2"></i>Network Activity
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="networkChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Predictions Tab -->
                    <div class="tab-pane fade" id="predictions" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-calendar-day me-2"></i>Daily Predictions
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="predictionsChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-seedling me-2"></i>Crop Distribution
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="cropChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-bug me-2"></i>Disease Distribution
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="diseaseChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-percentage me-2"></i>Confidence Levels
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="confidenceChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Prediction Stats -->
                        <div class="row" id="prediction-stats">
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 class="text-success" id="total-predictions">--</h4>
                                        <p class="text-muted mb-0">Total Predictions</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 class="text-primary" id="avg-confidence">--%</h4>
                                        <p class="text-muted mb-0">Avg Confidence</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 class="text-info" id="avg-processing">--ms</h4>
                                        <p class="text-muted mb-0">Avg Processing Time</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 class="text-warning" id="unique-diseases">--</h4>
                                        <p class="text-muted mb-0">Unique Diseases</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- User Behavior Tab -->
                    <div class="tab-pane fade" id="users" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-clock me-2"></i>Hourly Activity
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="activityChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-mobile-alt me-2"></i>Device Types
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="deviceChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-globe me-2"></i>Browser Distribution
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="browserChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-file-alt me-2"></i>Top Pages
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="pagesChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- User Stats -->
                        <div class="row" id="user-stats">
                            <div class="col-md-4 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 class="text-success" id="total-actions">--</h4>
                                        <p class="text-muted mb-0">Total Actions</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 class="text-primary" id="avg-session">--s</h4>
                                        <p class="text-muted mb-0">Avg Session Duration</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 class="text-info" id="unique-users">--</h4>
                                        <p class="text-muted mb-0">Unique Users</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Model Performance Tab -->
                    <div class="tab-pane fade" id="models" role="tabpanel">
                        <div class="row">
                            <div class="col-12 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-brain me-2"></i>Model Performance Metrics
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-striped" id="model-table">
                                                <thead>
                                                    <tr>
                                                        <th>Model Name</th>
                                                        <th>Accuracy</th>
                                                        <th>Precision</th>
                                                        <th>Recall</th>
                                                        <th>F1-Score</th>
                                                        <th>Inference Time</th>
                                                        <th>Evaluations</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="model-table-body">
                                                    <tr>
                                                        <td colspan="7" class="text-center text-muted">Loading model data...</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-chart-bar me-2"></i>Model Accuracy Comparison
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="accuracyChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-tachometer-alt me-2"></i>Inference Time Comparison
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="inferenceChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Errors Tab -->
                    <div class="tab-pane fade" id="errors" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-calendar-week me-2"></i>Daily Error Trends
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="errorTrendChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-exclamation-circle me-2"></i>Error Types
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="errorTypeChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-server me-2"></i>Errors by Endpoint
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="errorEndpointChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Error Stats -->
                        <div class="row" id="error-stats">
                            <div class="col-md-6 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 class="text-danger" id="total-errors">--</h4>
                                        <p class="text-muted mb-0">Total Errors</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h4 class="text-warning" id="error-rate">--%</h4>
                                        <p class="text-muted mb-0">Error Rate</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Refresh Button -->
    <button class="btn btn-success btn-lg rounded-circle refresh-btn" id="refresh-btn" title="Refresh Data">
        <i class="fas fa-sync-alt"></i>
    </button>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Analytics Dashboard JavaScript -->
    <script>
        class AnalyticsDashboard {
            constructor() {
                this.charts = {};
                this.data = {};
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadAllData();
                this.startAutoRefresh();
            }

            setupEventListeners() {
                document.getElementById('refresh-btn').addEventListener('click', () => {
                    this.loadAllData();
                });
            }

            startAutoRefresh() {
                setInterval(() => {
                    this.loadAllData();
                }, 30000); // Refresh every 30 seconds
            }

            async loadAllData() {
                try {
                    this.showLoading();

                    const [metrics, predictions, users, models, errors] = await Promise.all([
                        this.fetchData('/analytics/api/metrics'),
                        this.fetchData('/analytics/api/predictions'),
                        this.fetchData('/analytics/api/users'),
                        this.fetchData('/analytics/api/models'),
                        this.fetchData('/analytics/api/errors')
                    ]);

                    this.data = { metrics, predictions, users, models, errors };
                    this.updateUI();
                    this.updateCharts();
                    this.updateLastRefresh();

                } catch (error) {
                    console.error('Error loading analytics data:', error);
                    this.showError('Failed to load analytics data');
                } finally {
                    this.hideLoading();
                }
            }

            async fetchData(url) {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            }

            updateUI() {
                // Update system metrics cards
                if (this.data.metrics.current) {
                    document.getElementById('cpu-percent').textContent = `${this.data.metrics.current.cpu_percent.toFixed(1)}%`;
                    document.getElementById('memory-percent').textContent = `${this.data.metrics.current.memory_percent.toFixed(1)}%`;
                    document.getElementById('disk-percent').textContent = `${this.data.metrics.current.disk_usage.toFixed(1)}%`;
                    document.getElementById('active-requests').textContent = this.data.metrics.current.active_requests;
                }

                // Update prediction stats
                if (this.data.predictions) {
                    document.getElementById('total-predictions').textContent = this.data.predictions.total_predictions || 0;
                    document.getElementById('avg-confidence').textContent = this.data.predictions.avg_confidence ?
                        `${(this.data.predictions.avg_confidence * 100).toFixed(1)}%` : '--';
                    document.getElementById('avg-processing').textContent = this.data.predictions.avg_processing_time ?
                        `${(this.data.predictions.avg_processing_time * 1000).toFixed(0)}ms` : '--';
                    document.getElementById('unique-diseases').textContent = Object.keys(this.data.predictions.disease_distribution || {}).length;
                }

                // Update user stats
                if (this.data.users) {
                    document.getElementById('total-actions').textContent = this.data.users.total_actions || 0;
                    document.getElementById('avg-session').textContent = this.data.users.avg_session_duration ?
                        `${this.data.users.avg_session_duration.toFixed(1)}s` : '--';
                    document.getElementById('unique-users').textContent = '--'; // Would need user tracking
                }

                // Update error stats
                if (this.data.errors) {
                    document.getElementById('total-errors').textContent = this.data.errors.total_errors || 0;
                    document.getElementById('error-rate').textContent = '--'; // Would need request count
                }

                // Update model table
                this.updateModelTable();
            }

            updateModelTable() {
                const tbody = document.getElementById('model-table-body');
                if (!this.data.models || !this.data.models.model_summaries) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No model data available</td></tr>';
                    return;
                }

                const models = this.data.models.model_summaries;
                tbody.innerHTML = Object.entries(models).map(([name, metrics]) => `
                    <tr>
                        <td>${name}</td>
                        <td>${(metrics.avg_accuracy * 100).toFixed(1)}%</td>
                        <td>${(metrics.avg_precision * 100).toFixed(1)}%</td>
                        <td>${(metrics.avg_recall * 100).toFixed(1)}%</td>
                        <td>${(metrics.avg_f1_score * 100).toFixed(1)}%</td>
                        <td>${(metrics.avg_inference_time * 1000).toFixed(1)}ms</td>
                        <td>${metrics.performance_count}</td>
                    </tr>
                `).join('');
            }

            updateCharts() {
                this.createSystemChart();
                this.createNetworkChart();
                this.createPredictionsChart();
                this.createCropChart();
                this.createDiseaseChart();
                this.createConfidenceChart();
                this.createActivityChart();
                this.createDeviceChart();
                this.createBrowserChart();
                this.createPagesChart();
                this.createAccuracyChart();
                this.createInferenceChart();
                this.createErrorTrendChart();
                this.createErrorTypeChart();
                this.createErrorEndpointChart();
            }

            createSystemChart() {
                const ctx = document.getElementById('systemChart').getContext('2d');
                const data = this.data.metrics;

                if (this.charts.systemChart) this.charts.systemChart.destroy();

                this.charts.systemChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: (data.timestamps || []).map(t => moment(t * 1000).format('HH:mm')),
                        datasets: [{
                            label: 'CPU %',
                            data: data.cpu_percent || [],
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Memory %',
                            data: data.memory_percent || [],
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Disk %',
                            data: data.disk_usage || [],
                            borderColor: '#ffc107',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            createNetworkChart() {
                const ctx = document.getElementById('networkChart').getContext('2d');
                const data = this.data.metrics;

                if (this.charts.networkChart) this.charts.networkChart.destroy();

                this.charts.networkChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: (data.timestamps || []).map(t => moment(t * 1000).format('HH:mm')),
                        datasets: [{
                            label: 'Network Connections',
                            data: data.network_connections || [],
                            borderColor: '#6f42c1',
                            backgroundColor: 'rgba(111, 66, 193, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Active Requests',
                            data: data.active_requests || [],
                            borderColor: '#e83e8c',
                            backgroundColor: 'rgba(232, 62, 140, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            createPredictionsChart() {
                const ctx = document.getElementById('predictionsChart').getContext('2d');
                const data = this.data.predictions.daily_predictions || {};

                if (this.charts.predictionsChart) this.charts.predictionsChart.destroy();

                this.charts.predictionsChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            label: 'Predictions',
                            data: Object.values(data),
                            backgroundColor: 'rgba(40, 167, 69, 0.8)',
                            borderColor: '#28a745',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            createCropChart() {
                const ctx = document.getElementById('cropChart').getContext('2d');
                const data = this.data.predictions.crop_distribution || {};

                if (this.charts.cropChart) this.charts.cropChart.destroy();

                this.charts.cropChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            data: Object.values(data),
                            backgroundColor: [
                                '#28a745', '#007bff', '#ffc107', '#dc3545',
                                '#6f42c1', '#e83e8c', '#20c997', '#fd7e14'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            createDiseaseChart() {
                const ctx = document.getElementById('diseaseChart').getContext('2d');
                const data = this.data.predictions.disease_distribution || {};

                if (this.charts.diseaseChart) this.charts.diseaseChart.destroy();

                this.charts.diseaseChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            label: 'Occurrences',
                            data: Object.values(data),
                            backgroundColor: 'rgba(220, 53, 69, 0.8)',
                            borderColor: '#dc3545',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y'
                    }
                });
            }

            createConfidenceChart() {
                const ctx = document.getElementById('confidenceChart').getContext('2d');
                const data = this.data.predictions.confidence_ranges || {};

                if (this.charts.confidenceChart) this.charts.confidenceChart.destroy();

                this.charts.confidenceChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['High (>80%)', 'Medium (60-80%)', 'Low (<60%)'],
                        datasets: [{
                            data: [data.high || 0, data.medium || 0, data.low || 0],
                            backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            createActivityChart() {
                const ctx = document.getElementById('activityChart').getContext('2d');
                const data = this.data.users.hourly_activity || {};

                if (this.charts.activityChart) this.charts.activityChart.destroy();

                this.charts.activityChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'Activity',
                            data: Array.from({length: 24}, (_, i) => data[i] || 0),
                            backgroundColor: 'rgba(0, 123, 255, 0.8)',
                            borderColor: '#007bff',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            createDeviceChart() {
                const ctx = document.getElementById('deviceChart').getContext('2d');
                const data = this.data.users.device_distribution || {};

                if (this.charts.deviceChart) this.charts.deviceChart.destroy();

                this.charts.deviceChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            data: Object.values(data),
                            backgroundColor: ['#28a745', '#007bff', '#ffc107', '#dc3545']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            createBrowserChart() {
                const ctx = document.getElementById('browserChart').getContext('2d');
                const data = this.data.users.browser_distribution || {};

                if (this.charts.browserChart) this.charts.browserChart.destroy();

                this.charts.browserChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            label: 'Users',
                            data: Object.values(data),
                            backgroundColor: 'rgba(111, 66, 193, 0.8)',
                            borderColor: '#6f42c1',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y'
                    }
                });
            }

            createPagesChart() {
                const ctx = document.getElementById('pagesChart').getContext('2d');
                const data = this.data.users.top_pages || {};

                if (this.charts.pagesChart) this.charts.pagesChart.destroy();

                this.charts.pagesChart = new Chart(ctx, {
                    type: 'horizontalBar',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            label: 'Views',
                            data: Object.values(data),
                            backgroundColor: 'rgba(32, 201, 151, 0.8)',
                            borderColor: '#20c997',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y'
                    }
                });
            }

            createAccuracyChart() {
                const ctx = document.getElementById('accuracyChart').getContext('2d');
                const data = this.data.models.model_summaries || {};

                if (this.charts.accuracyChart) this.charts.accuracyChart.destroy();

                this.charts.accuracyChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            label: 'Accuracy',
                            data: Object.values(data).map(m => m.avg_accuracy * 100),
                            backgroundColor: 'rgba(40, 167, 69, 0.8)',
                            borderColor: '#28a745',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            createInferenceChart() {
                const ctx = document.getElementById('inferenceChart').getContext('2d');
                const data = this.data.models.model_summaries || {};

                if (this.charts.inferenceChart) this.charts.inferenceChart.destroy();

                this.charts.inferenceChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            label: 'Inference Time (ms)',
                            data: Object.values(data).map(m => m.avg_inference_time * 1000),
                            backgroundColor: 'rgba(255, 193, 7, 0.8)',
                            borderColor: '#ffc107',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            createErrorTrendChart() {
                const ctx = document.getElementById('errorTrendChart').getContext('2d');
                const data = this.data.errors.daily_errors || {};

                if (this.charts.errorTrendChart) this.charts.errorTrendChart.destroy();

                this.charts.errorTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            label: 'Errors',
                            data: Object.values(data),
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            createErrorTypeChart() {
                const ctx = document.getElementById('errorTypeChart').getContext('2d');
                const data = this.data.errors.error_type_distribution || {};

                if (this.charts.errorTypeChart) this.charts.errorTypeChart.destroy();

                this.charts.errorTypeChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            data: Object.values(data),
                            backgroundColor: ['#dc3545', '#fd7e14', '#ffc107', '#28a745', '#007bff']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            createErrorEndpointChart() {
                const ctx = document.getElementById('errorEndpointChart').getContext('2d');
                const data = this.data.errors.error_endpoint_distribution || {};

                if (this.charts.errorEndpointChart) this.charts.errorEndpointChart.destroy();

                this.charts.errorEndpointChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            label: 'Errors',
                            data: Object.values(data),
                            backgroundColor: 'rgba(220, 53, 69, 0.8)',
                            borderColor: '#dc3545',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y'
                    }
                });
            }

            updateLastRefresh() {
                document.getElementById('update-time').textContent = moment().format('HH:mm:ss');
            }

            showLoading() {
                document.getElementById('status-badge').innerHTML =
                    '<i class="fas fa-spinner fa-spin me-1"></i>Loading...';
                document.getElementById('status-badge').className = 'badge bg-warning';
            }

            hideLoading() {
                document.getElementById('status-badge').innerHTML =
                    '<i class="fas fa-circle me-1"></i>Live';
                document.getElementById('status-badge').className = 'badge bg-success';
            }

            showError(message) {
                // Could implement toast notifications here
                console.error(message);
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new AnalyticsDashboard();
        });
    </script>
</body>
</html>